---
# draft search index json
---
{%- assign items = site.data[site.metadata] | where_exp: 'item','item.objectid' -%}
{%- assign fields = site.data.config-search-index -%}
[
    {%- for item in items -%}
    { 
        {% for f in fields %}{% if item[f.field] %}{{ f.dcterm | jsonify }}: {{ item[f.field] | jsonify }},{% endif %}
        {% endfor %}
        {% if item.image_thumb %}"thumb": "{{ item.image_thumb | absolute_url }}",{% endif %}
        {% if item.object_transcript %}"transcript": {% assign transcript_type = page.object_transcript | slice: 0,8 %}{% if transcript_type == 'objects/' %}{% assign transcript = site.pages | where: 'path',page.object_transcript | first %}{{ transcript.content | markdownify | jsonify }}{% else %}{{ page.object_transcript | markdownify | jsonfiy }}{% endif %},{% endif %}
        {% if item.object_location %}"file": "{{ item.object_location | absolute_url }}",{% endif %}
        {% if item.format contains 'pdf' %}"text": true,{% endif %}
        "objectid": "{% if item.parentid %}{{ item.parentid }}#{% endif %}{{ item.objectid }}",
        "url": "{{ '/items/' | absolute_url }}{% if item.parentid %}{{ item.parentid }}.html#{{ item.objectid }}{% else %}{{ item.objectid }}.html{% endif %}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
] 
